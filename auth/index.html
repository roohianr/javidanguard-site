<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sign in</title>
<style>body{font:16px system-ui;margin:0;display:grid;place-items:center;height:100vh;background:#0b0b0f;color:#fff}
.card{background:#111a;border:1px solid #333;padding:24px;border-radius:12px;min-width:320px}
.row{display:flex;gap:8px;margin:.5rem 0;align-items:center}
input,button{font:inherit;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a1a;color:#fff}
button{cursor:pointer}
</style>
</head><body>
<div class="card">
  <h2>Passkey Sign-in</h2>
  <div class="row"><input id="handle" placeholder="Handle (optional for register)"/></div>
  <div class="row">
    <button id="reg">Register passkey</button>
    <button id="login">Login</button>
  </div>
  <div id="msg"></div>
</div>
<script src="https://unpkg.com/@simplewebauthn/browser@13.1.2/dist/bundle/index.umd.min.js"></script>
<script>
  const { startRegistration, startAuthentication } = window.SimpleWebAuthnBrowser;

  // Wire buttons (assumes you have #handle, #reg, #login)
  document.getElementById('reg').onclick = () => {
    const handle = document.getElementById('handle').value || 'user';
    doRegister(handle);
  };
  document.getElementById('login').onclick = () => doLogin();

  // Register
  async function doRegister(handle) {
    const start = await fetch('/api/auth/reg-start', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ handle })
    }).then(r=>r.json());

    const att = await startRegistration(start.options);

    const done = await fetch('/api/auth/reg-finish', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(att)
    }).then(r=>r.json());

    if (done.ok) location.href = '/user/';
    else alert(done.message || 'Registration failed');
  }

  // Login
  async function doLogin() {
    const start = await fetch('/api/auth/login-start', { method:'POST' }).then(r=>r.json());
    const ass = await startAuthentication(start.options);

    const done = await fetch('/api/auth/login-finish', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(ass)
    }).then(r=>r.json());

    if (done.ok) location.href = '/user/';
    else alert(done.message || 'Login failed');
  }
</script>

</body></html>
