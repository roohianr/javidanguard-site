<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ¬Ø§ Ù†Ø±ÙØªÙ‡â€ŒÛŒ Ù…Ù†</title>
<link rel="preload" href="/assets/Vazirmatn/Vazirmatn-Variable.woff2" as="font" type="font/woff2" crossorigin>
<link rel="stylesheet" href="/css/theme.css">
<link rel="stylesheet" href="/css/components.css">
<style>
  .topbar{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:14px}
  .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end}
  .field{display:flex; flex-direction:column; gap:6px}
  .label{font-size:12px; color:var(--muted)}
  .mini{width:90px; background:#0a1221; color:var(--text); border:1px solid rgba(255,255,255,.1); padding:10px 12px; border-radius:10px}
  .mini::-webkit-outer-spin-button,.mini::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
  .btn{background:#0a1221; color:var(--text); border:1px solid rgba(255,255,255,.1); padding:10px 14px; border-radius:10px; font-weight:700}
  .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:#00111a; border:none}

  .canvas{width:100%; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; box-shadow:var(--shadow-md)}

  .facts{display:grid; gap:10px; grid-template-columns:repeat(3,1fr); margin-bottom:12px}
  @media (max-width:900px){ .facts{ grid-template-columns:1fr } }
  .fact{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px}
  .fact .num{font-weight:800; font-size:22px}
  .fact .lbl{color:var(--muted); font-size:12px; margin-top:4px}

  .legend{display:flex; gap:12px; align-items:center; color:var(--muted); font-size:13px}

  .grid{
    --cols:52; --gap:2px;
    display:grid; grid-template-columns:repeat(var(--cols), 1fr);
    gap:var(--gap); background:rgba(255,255,255,.06); padding:var(--gap); border-radius:10px;
  }
  .cell{
    aspect-ratio:1/1; background:rgba(255,255,255,.02);
    border:1px solid rgba(255,255,255,.06); border-radius:3px; position:relative;
  }
  /* softer red for past */
  :root{ --past-bg: rgba(239, 68, 68, 0.38); --past-br: rgba(185, 28, 28, 0.55) }
  .cell.past{ background:var(--past-bg); border-color:var(--past-br) }
  .cell.past::before{
    content:""; position:absolute; inset:0; border-radius:3px;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
    pointer-events:none;
  }
  /* icons only on past cells */
  .cell.past.sun::after{ content:"â˜€ï¸"; position:absolute; inset:0; font-size:10px; display:grid; place-items:center }
  .cell.past.poop::after{ content:"ğŸ’©"; position:absolute; inset:0; font-size:10px; display:grid; place-items:center }

  .meta{display:flex; justify-content:space-between; gap:10px; margin-top:10px; color:var(--muted); font-size:13px}

  .note{margin-top:12px; color:#cbd5e1; font-size:13px; line-height:1.75}
  .note strong{color:#e5e7eb}

  /* PRINT â€” force single A3 page with auto-scale */
 @media print{
  @page{ size:A3 portrait; margin:10mm }

  /* Hide UI in print */
  .topbar .controls,
  .emblem,
  .user-btn,
  .btn.primary,
  .btn.calc{ display:none !important }

  body{ background:#fff; color:#000 }
  .canvas{ box-shadow:none; border:0; padding:0 }
  .legend,.note{ color:#111 }
  .fact{ background:#fff; border-color:#999 }
  .fact .num{ color:#000 }

  /* Fit EVERYTHING below into ONE A3 sheet */
  .print-area{
    width:277mm;              /* 297 - (2Ã—10mm margins) */
    max-height:400mm;         /* 420 - (2Ã—10mm margins) */
    overflow:hidden;
    break-inside:avoid;
    page-break-inside:avoid;
    transform-origin:top left;
  }

  /* Tight, fixed-mm grid so 78 rows fit */
  .grid{
    --gap:1mm;
    --cell:3mm;               /* â†“ if you still see 2 pages, try 2.8mm */
    display:grid;
    grid-template-columns:repeat(52, var(--cell));
    gap:var(--gap);
    padding:0;
    margin:4mm 0 0 0;
  }
  .cell{
    width:var(--cell);
    height:var(--cell);
    aspect-ratio:auto !important;
    border:0.2mm solid #777;
  }
  .cell.past{ background:#ffc5c5 !important } /* light red on paper */

  /* Keep blocks together */
  .facts, .meta, .note{ break-inside:avoid; page-break-inside:avoid }
}
</style>
</head>
<body>
  <!-- watermark -->
  <img class="emblem" src="/assets/lion-sun.svg" alt="Ø´ÛŒØ± Ùˆ Ø®ÙˆØ±Ø´ÛŒØ¯">
  <!-- top-right user button -->
  <a class="user-btn" href="/login.html" aria-label="ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 12c2.761 0 5-2.462 5-5.5S14.761 1 12 1 7 3.462 7 6.5 9.239 12 12 12Zm0 2c-4.97 0-9 3.582-9 8 0 .552.448 1 1 1h16c.552 0 1-.448 1-1 0-4.418-4.03-8-9-8Z" fill="currentColor"/></svg>
  </a>

  <div class="wrap" style="justify-content:flex-start">
    <div class="title" style="margin-top:18px">
      <h1>Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ¬Ø§ Ù†Ø±ÙØªÙ‡â€ŒÛŒ Ù…Ù†</h1>
      <div class="subtitle">Ø³Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø§Ù„Ø§ (Ø³Ø§Ù„/Ù…Ø§Ù‡/Ø±ÙˆØ²) Ø±Ø§ Ù¾Ø± Ú©Ù†ØŒ Ø¨Ø¹Ø¯ Â«Ù…Ø­Ø§Ø³Ø¨Ù‡Â» Ø±Ø§ Ø¨Ø²Ù†. ÙÙ‚Ø· Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø°Ø´ØªÙ‡ Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</div>
    </div>

    <div class="canvas">
      <div class="topbar">
        <div class="controls">
          <div class="field">
            <label class="label" for="jy">Ø³Ø§Ù„ (Ø¬Ù„Ø§Ù„ÛŒ)</label>
            <input id="jy" class="mini" type="number" inputmode="numeric" placeholder="1370" min="1200" max="1500">
          </div>
          <div class="field">
            <label class="label" for="jm">Ù…Ø§Ù‡</label>
            <input id="jm" class="mini" type="number" inputmode="numeric" placeholder="05" min="1" max="12">
          </div>
          <div class="field">
            <label class="label" for="jd">Ø±ÙˆØ²</label>
            <input id="jd" class="mini" type="number" inputmode="numeric" placeholder="04" min="1" max="31">
          </div>
          <div class="field">
            <label class="label" for="expect">Ø§Ù…ÛŒØ¯ Ø¨Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ (Ø³Ø§Ù„)</label>
            <input id="expect" class="mini" type="number" value="78" min="40" max="120" step="1">
          </div>
          <button class="btn calc" onclick="build()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
          <button id="printBtn" class="btn primary" onclick="window.print()" hidden>Ù¾Ø±ÛŒÙ†Øª A3</button>
        </div>
        <div class="legend">
          <span>â˜€ï¸ Ù‚Ø¨Ù„ Ø§Ø² Û±Û² Ø¨Ù‡Ù…Ù† Û±Û³ÛµÛ·</span>
          <span>ğŸ’© Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù†</span>
        </div>
      </div>

      <!-- everything below scales to fit a single sheet -->
      <div class="print-area" id="printArea">
        <!-- FACT BOXES -->
        <div class="facts">
          <div class="fact"><div class="num" id="f-lived">â€”</div><div class="lbl">Ù‡ÙØªÙ‡ Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒ</div></div>
          <div class="fact"><div class="num" id="f-sunpoop">â€”</div><div class="lbl">Ø§Ø² Ø§ÛŒÙ† ØªØ¹Ø¯Ø§Ø¯: â˜€ï¸ Ù‚Ø¨Ù„ Ø§Ø² Û±Û² Ø¨Ù‡Ù…Ù† / ğŸ’© Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù†</div></div>
          <div class="fact"><div class="num" id="f-left">â€”</div><div class="lbl">Ù‡ÙØªÙ‡ ØªØ§ Ø§ÙÙ‚ Ù†Ù…Ø§ÛŒØ´</div></div>
        </div>

        <div id="grid" class="grid" aria-label="Ú¯Ø±ÛŒØ¯ Ù‡ÙØªÙ‡â€ŒÙ‡Ø§"></div>

        <div class="meta">
          <div id="statsLeft"></div>
          <div id="statsRight"></div>
        </div>

        <div class="note">
          <strong>Ú†Ø±Ø§ Û±Û² Ø¨Ù‡Ù…Ù†ØŸ</strong>
          Ú†ÙˆÙ† Ø¨Ø§ÙˆØ± Ø¯Ø§Ø±Ù… Ø§ØªÙ„Ø§Ù Ø²Ù†Ø¯Ú¯ÛŒ Ù…Ø§ Ø§Ø² ÙˆÙ‚ØªÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯ Ú©Ù‡ <strong>Ø´Ø§Ù‡ Ø±ÙØª</strong>ØŒ Ù†Ù‡ ÙˆÙ‚ØªÛŒ Ú©Ù‡ <strong>Ø®Ù…ÛŒÙ†ÛŒ Ø¢Ù…Ø¯</strong>.
          Ù…Ø±Ø² Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø±Ø§ <strong>Û±Û² Ø¨Ù‡Ù…Ù† Û±Û³ÛµÛ·</strong> Ú¯Ø°Ø§Ø´ØªÙ‡â€ŒØ§Ù…Ø› Ù‡Ø± Ú†Ù‡ Ù¾ÛŒØ´ Ø§Ø² Ø¢Ù† Ø¨ÙˆØ¯ Ø¨Ø§ â˜€ï¸ Ùˆ Ù¾Ø³ Ø§Ø² Ø¢Ù† Ø¨Ø§ ğŸ’© Ù†Ø´Ø§Ù†Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
          (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø°Ø´ØªÙ‡).
        </div>
      </div>
    </div>
  </div>

<script>
/* ==== Jalali â†’ Gregorian (reliable) ==== */
function j2g(jy, jm, jd){
  var jy2 = jy - 979, jm2 = jm - 1, jd2 = jd - 1;
  var j_day_no = 365*jy2 + Math.floor(jy2/33)*8 + Math.floor((jy2%33 + 3)/4);
  for (var i=0; i<jm2; ++i) j_day_no += (i<6)?31:30;
  j_day_no += jd2;
  var g_day_no = j_day_no + 79;
  var gy = 1600 + 400*Math.floor(g_day_no/146097); g_day_no %= 146097;
  var leap = true;
  if (g_day_no >= 36525){ g_day_no--; gy += 100*Math.floor(g_day_no/36524); g_day_no %= 36524; if (g_day_no >= 365) g_day_no++; else leap=false; }
  gy += 4*Math.floor(g_day_no/1461); g_day_no %= 1461;
  if (g_day_no >= 366){ leap=false; g_day_no--; gy += Math.floor(g_day_no/365); g_day_no %= 365; }
  var gd = g_day_no + 1, sal=[0,31,(leap?29:28),31,30,31,30,31,31,30,31,30,31], gm=1;
  while (gm<=12 && gd>sal[gm]){ gd -= sal[gm++]; }
  return [gy, gm, gd];
}
function jDateUTC(jy,jm,jd){ const [gy,gm,gd] = j2g(jy,jm,jd); return new Date(Date.UTC(gy, gm-1, gd)); }
function todayUTC(){ const t=new Date(); return new Date(Date.UTC(t.getUTCFullYear(), t.getUTCMonth(), t.getUTCDate())); }
function addWeeksUTC(date, w){ return new Date(date.getTime() + w*7*24*60*60*1000); }
function weeksBetweenUTC(a,b){ return Math.floor((b - a) / (7*24*60*60*1000)); }

/* Boundary: Û±Û² Ø¨Ù‡Ù…Ù† Û±Û³ÛµÛ· */
const REVOLUTION = jDateUTC(1357,11,12);

const gridEl = document.getElementById('grid');
const printBtn = document.getElementById('printBtn');
const fLived = document.getElementById('f-lived');
const fSunPoop = document.getElementById('f-sunpoop');
const fLeft = document.getElementById('f-left');
const statsLeft = document.getElementById('statsLeft');
const statsRight = document.getElementById('statsRight');

function build(){
  const jy = +document.getElementById('jy').value;
  const jm = +document.getElementById('jm').value;
  const jd = +document.getElementById('jd').value;
  const exp = Math.max(40, Math.min(120, +document.getElementById('expect').value || 78));

  if(!jy || !jm || !jd || jm<1 || jm>12 || jd<1 || jd>31){
    alert('Ø³Ø§Ù„/Ù…Ø§Ù‡/Ø±ÙˆØ² Ø¬Ù„Ø§Ù„ÛŒ Ø±Ø§ Ø¯Ø±Ø³Øª ÙˆØ§Ø±Ø¯ Ú©Ù† (Ù…Ø«Ù„Ø§Ù‹ 1370 / 05 / 04).');
    return;
  }

  const dob = jDateUTC(jy,jm,jd);
  const today = todayUTC();

  const ageWeeks = Math.max(0, weeksBetweenUTC(dob, today));
  const ageYears = ageWeeks / 52;
  const displayYears = Math.max(exp, Math.ceil(ageYears + 5));
  const totalWeeks = displayYears * 52;

  // counts under â˜€ï¸ (before boundary) and ğŸ’© (after), only among PAST weeks
  let sunWeeks = 0;
  if (dob < REVOLUTION) {
    const sunEnd = (today < REVOLUTION) ? today : REVOLUTION;
    sunWeeks = Math.max(0, weeksBetweenUTC(dob, sunEnd));
  }
  const poopPastWeeks = Math.max(0, ageWeeks - sunWeeks);
  const leftWeeks = Math.max(0, totalWeeks - ageWeeks);

  // FACTS
  fLived.textContent   = ageWeeks.toLocaleString('fa-IR');
  fSunPoop.textContent = `â˜€ï¸ ${sunWeeks.toLocaleString('fa-IR')}  /  ğŸ’© ${poopPastWeeks.toLocaleString('fa-IR')}`;
  fLeft.textContent    = leftWeeks.toLocaleString('fa-IR');

  // GRID
  gridEl.textContent = '';
  for (let w=0; w<totalWeeks; w++){
    const d = addWeeksUTC(dob, w);
    const isPast = d <= today;
    const isSun = d < REVOLUTION;
    const cell = document.createElement('div');
    cell.className = 'cell' + (isPast ? ' past' : '') + (isSun ? ' sun' : ' poop');
    gridEl.appendChild(cell);
  }

  statsLeft.textContent  = `Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø°Ø´ØªÙ‡: ${ageWeeks.toLocaleString('fa-IR')}`;
  statsRight.textContent = `Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ ØªØ§ ${displayYears} Ø³Ø§Ù„: ${leftWeeks.toLocaleString('fa-IR')}`;

  printBtn.hidden = false;

  // remember inputs
  localStorage.setItem('wofl-jy', String(jy));
  localStorage.setItem('wofl-jm', String(jm).padStart(2,'0'));
  localStorage.setItem('wofl-jd', String(jd).padStart(2,'0'));
}

/* Restore inputs */
(function(){
  const jy=document.getElementById('jy'), jm=document.getElementById('jm'), jd=document.getElementById('jd');
  jy.value = localStorage.getItem('wofl-jy') || '';
  jm.value = localStorage.getItem('wofl-jm') || '';
  jd.value = localStorage.getItem('wofl-jd') || '';
})();

/* PRINT auto-scale to guarantee ONE A3 page */
(function(){
  const area = document.getElementById('printArea');
  function fitForPrint(){
    if(!area) return;
    area.style.transform = 'none';
    const availW = window.innerWidth || document.documentElement.clientWidth;
    const availH = window.innerHeight || document.documentElement.clientHeight;
    const needW  = area.scrollWidth;
    const needH  = area.scrollHeight;
    const scale = Math.min(1, (availW-8)/needW, (availH-8)/needH);
    area.style.transform = `scale(${scale})`;
  }
  if (window.matchMedia) {
    const mq = window.matchMedia('print');
    mq.addEventListener ? mq.addEventListener('change', e => { if(e.matches) fitForPrint(); }) : null;
  }
  window.onbeforeprint = fitForPrint;
  window.onafterprint = () => { if(area) area.style.transform='none'; };
})();
</script>
</body>
</html>
